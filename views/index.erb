<form class="search-form pure-form" autocomplete="off" style="text-align: center">
  <fieldset>
    <legend>
      Type your favorite animal species below:
    </legend>

    <input type="text" name="species" placeholder="Homo sapiens">

    <button type="submit" class="pure-button pure-button-primary">Go</button>
  </fieldset>
</form>

<div id="species-map" style="height: 500px;"></div>

<script type="text/javascript">
  $(document).ready(function() {
    var initializeMap = function(idString) {
      var mymap = L.map(idString).setView([0, 0], 2);
      L.tileLayer('http://korona.geog.uni-heidelberg.de/tiles/roads/x={x}&y={y}&z={z}', {
        minZoom: 2,
        maxZoom: 4,
        attribution: 'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(mymap);
      return mymap;
    };
    var addMarker = function(lat, lng) {
      var marker = L.marker([lat, lng]);
      markers.push(marker);
      marker.addTo(mymap);
    };
    var clearMarkers = function() {
      markers.map(function(marker) {
        mymap.removeLayer(marker);
      });
      markers = [];
    };

    var mymap = initializeMap("species-map");
    var markers = [];

    $(".search-form").submit(function(e) {
      e.preventDefault();

      var species = $(this).find("input").val();

      var $button = $(this).find("button");
      $button.text("Loading...");

      $.get("/search.json", { species: species })
       .done(function(results) {
         clearMarkers();
         JSON.parse(results).map(function(result) {
           addMarker(result["latitude"], result["longitude"]);
         });
         $button.text("Go");
       });
    });
  });
</script>
